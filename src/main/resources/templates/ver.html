<!DOCTYPE html>
<html lang="en" xmlns:th="https://www.thymeleaf.org" xmlns:sec="https://www.thymeleaf.org/extras/spring-security">
<head th:replace="layout/fragment::head"></head>
<body>
<header th:replace="layout/fragment::header"></header>
<div th:if="${msg != null}" th:text="${msg}" class="alert alert-success"></div>
<div th:if="${error != null}" th:text="${error}" class="alert alert-danger"></div>

<div class="container py-4">
    <div class="card">
        <div class="card-header">
            <h4 th:text="${titulo} + ': ' + ${cliente.nombre}"></h4>

        </div>
        <div class="card-body">
            <ul class="nav nav-pills card-header-pills">
                <li class="nav-item">
                    <a class="btn btn-secondary mx-4" th:href="@{/}">&laquo;  Volver</a>
                </li>
                <li class="nav-item">
                    <a class="btn btn-primary" th:href="@{/factura/form/{clienteId}(clienteId=${cliente.id})}" sec:authorize="hasRole('ROLE_ADMIN')">Crear
                        Factura</a>
                </li>
            </ul>

            <img th:if="${#strings.length(cliente.foto) > 0}" th:src="@{'/uploads/'+ ${cliente.foto}}"
                 class="img-thumbnail rounded float-left" style="max-width: 20%" th:alt="${cliente.foto}"/>

            <ul class="list-group mt-4">
                <li class="list-group-item active" th:text="${cliente.nombre}"></li>
                <li class="list-group-item" th:text="${cliente.apellidos}"></li>
                <li class="list-group-item" th:text="${cliente.email}"></li>
                <li class="list-group-item" th:text="${cliente.telefono}"></li>
            </ul>

            <div th:if="${#lists.isEmpty(cliente.facturas)}" class="alert alert-info my-4"
                 th:text="'No tiene facturas asignadas'"></div>

            <table th:if="${not #lists.isEmpty(cliente.facturas)}" class="table table-striped mt-4">
                <thead class="table-light">
                <tr>
                    <th>Folio</th>
                    <th>Descripción</th>
                    <th>Total</th>
                    <th>Fecha</th>
                    <th sec:authorize="hasRole('ROLE_ADMIN')">Detalle</th>
                    <th sec:authorize="hasRole('ROLE_ADMIN')">Eliminar</th>
                </tr>
                </thead>

                <tbody>
                <tr th:each="factura : ${cliente.facturas}">
                    <td th:text="${factura.id}"></td>
                    <td th:text="${factura.descripcion}"></td>
                    <td th:text="${factura.total}"></td>
                    <td th:text="${factura.createAt}"></td>
                    <td sec:authorize="hasRole('ROLE_ADMIN')"><a class="btn btn-primary" th:href="@{/factura/detalle/{id}(id=${factura.id})}" >Ver</a></td>
                    <td sec:authorize="hasRole('ROLE_ADMIN')"><a class="btn btn-danger" th:href="@{/factura/eliminar/{id}(id=${factura.id})}"
                    onclick="return confirm('¿Estas seguro que deseas eliminar la factura?');" >X</a></td>
                </tr>
                </tbody>
            </table>

        </div>
    </div>
</div>

<footer th:replace="layout/fragment::footer"></footer>
</body>
</html>